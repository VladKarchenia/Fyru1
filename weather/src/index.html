<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>The Weather</title>
    <link rel="stylesheet" href="styles.css" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>
<body>
    <div class="wrapper_content">
        <header>
            <nav>
                <a href="#" class="logo"></a>
                <h1>THE WEATHER</h1>
                <ul class="menu">
                    <li class="item"><a href="#">Today</a></li>
                    <li class="item"><a href="#">3 Days</a></li>
                    <li class="item"><a href="#">Week</a></li>
                    <li class="item"><a href="#">2 Weeks</a></li>
                    <li class="item"><a href="#">Weather History</a></li>
                </ul>
            </nav>
        </header>
        <div class="search_city">
            <form action="" method="get">
                <input name"search" type="search" placeholder="City">
                <button type="submit" id="myBtn"></button>
            </form>
        </div>
        <h1 id="city_name"></h1>
        <div class="weather_today">
            <div class="weather_container">
                <span class="date" id="date_today"></span>
                <h3>Current Weather</h3>
                <div><img id="img_today" src="" alt="" /></div>
                <div class="info">
                    <span class="curr_temp" id="curr_temper"></span>
                </div>
                <span class="cond" id="cond_today"></span>
            </div>
            <div class="table">
                <table>
                    <tr>
                        <th>Wind</th>
                        <th>Cloudiness</th>
                        <th>Pressure</th>
                        <th>Humidity</th>
                        <th>Sunrise</th>
                        <th>Sunset</th>
                    </tr>
                    <tr>
                        <td class="wind"></td>
                        <td class="cloudiness"></td>
                        <td class="pressure"></td>
                        <td class="humidity"></td>
                        <td class="sunrise"></td>
                        <td class="sunset"></td>
                    </tr>
                </table>
            </div>    
        </div>
        <div class="weather_tomorrow">
            <div class="weather_container">
                <span class="date" id="date_tomorrow"></span>
                <h3>Tomorrow</h3>
                <div><img id="img_tomorrow" src="" alt="" /></div>
                <div class="info">
                    <span class="curr_temp" id="tomw_temper"></span>
                </div>
                <span class="cond" id="cond_tomorrow"></span>
            </div>
        </div>
        <div class="for_3_days">
            <div class="">
                <h3 class="date"></h3>
                <div class="weather_img"></div>
                <div class="info">
                    <span class="curr_temp"></span>
                </div>
                <span class="cond"></span>
            </div>
            <div class="">
                <h3 class="date"></h3>
                <div class="weather_img"></div>
                <div class="info">
                    <span class="curr_temp"></span>
                </div>
                <span class="cond"></span>
            </div>
            <div class="">
                <h3 class="date"></h3>
                <div class="weather_img"></div>
                <div class="info">
                    <span class="curr_temp"></span>
                </div>
                <span class="cond"></span>
            </div>
        </div>
        <div class="for_2_Weeks">
        </div>
        <div class="map">
            <h2>Current Location</h2>
            <div id="map"></div>
        </div>
        <footer>
            <ul class="footer_list">
                <li><a href="#">About Us</a></li>
                <li><a href="#">Security</a></li>
                <li><a href="#">Support</a></li>
                <li><a href="#">Feedback</a></li>
                <li><a href="#">Contact Us</a></li>
                <li><a href="#">Privacy</a></li>
                <li><a href="#">&#9773; Copyright</a></li>
                <li><a href="#">Terms + Conditions</a></li>
            </ul>
        </footer>
    </div>
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
    <script src="https://yandex.st/jquery/2.2.3/jquery.min.js" type="text/javascript"></script>
    <script>
        ymaps.ready(function () {
            let map
            ymaps.geolocation.get().then(function (res) {
                const mapContainer = $('#map'),
                bounds = res.geoObjects.get(0).properties.get('boundedBy'),
                mapState = ymaps.util.bounds.getCenterAndZoom(
                    bounds,
                    [mapContainer.width(), mapContainer.height()]
                )
                createMap(mapState)
            }, function (e) {
                createMap({
                    center: [55.751574, 37.573856],
                    zoom: 8
                })
            })
        //     let myPlacemark = new ymaps.Placemark(map.getCenter(), {
        //     preset: 'islands#redDotIcon'
        // })
        // myMap.geoObjects.add(myPlacemark)
        })
        
        function createMap (state) {
            map = new ymaps.Map('map', state)
        }

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                const pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                }

                function ajax(method = 'GET', url, callback) {
                    const xhr = new XMLHttpRequest()
                    xhr.open(method, url)

                    xhr.onreadystatechange = () => {
                        console.log({ readyState: xhr.readyState, status: xhr.status })
                        if (xhr.readyState === 4 && xhr.status === 200) {
                            const response = JSON.parse(xhr.responseText)
                            callback && callback(response)
                        } else {
                            new Error(xhr.status ? xhr.statusText : 'Request failed')
                        }
                    }

                    xhr.send()
                    return xhr
                }

                const updateTemp = (data) => {
                    console.log(data)

                    let sunriseTime = new Date(data.sys.sunrise * 1000)
                    let sunsetTime = new Date(data.sys.sunset * 1000)
                    const options = {
                        hour: 'numeric',
                        minute: 'numeric'
                    }

                    document.getElementById('img_today').src = 'http://openweathermap.org/img/w/' + data.weather[0].icon + '.png'
                    document.getElementById('curr_temper').innerText = Math.round(data.main.temp)
                    document.getElementById('cond_today').innerText = data.weather[0].description
                    document.getElementsByTagName('td')[0].innerText = data.wind.speed.toFixed(1) + ' m/s' + '\n' + data.wind.deg
                    document.getElementsByTagName('td')[1].innerText = data.weather[0].description
                    document.getElementsByTagName('td')[2].innerText = (data.main.pressure / 10).toFixed(1) + ' kPa'
                    document.getElementsByTagName('td')[3].innerText = data.main.humidity + ' %'
                    document.getElementsByTagName('td')[4].innerText = sunriseTime.toLocaleString("ru", options)
                    document.getElementsByTagName('td')[5].innerText = sunsetTime.toLocaleString("ru", options)
                }
                const getcurtemp = () => ajax('GET', 'http://api.openweathermap.org/data/2.5/weather?lat=' + pos.lat + '&lon=' + pos.lng + '&units=metric&APPID=c6f8dd0d039e624a468cee0667029f1f', updateTemp)
                getcurtemp()

                window.onload = initDate
                function initDate() {
                    const dayName = new Array("Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday","Saturday")
                    const monName = new Array("January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December")
                    let now = new Date(),
                        tomorrow = new Date(now.getTime() + (24 * 60 * 60 * 1000)),
                        dtString = dayName[now.getDay()] + '<br>' + monName[now.getMonth()] + " " + now.getDate(),
                        dttmString = dayName[tomorrow.getDay()] + '<br>' + monName[tomorrow.getMonth()] + " " + tomorrow.getDate()
                    document.getElementById('date_today').innerHTML = dtString
                    document.getElementById('date_tomorrow').innerHTML = dttmString
                }
            })
        }
    </script>
</body>
</html>
